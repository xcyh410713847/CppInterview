# Memory

在 C++ 中，内存布局和程序分段是两个重要的概念，理解它们可以帮助开发者更好地管理内存、优化程序性能并避免潜在的内存错误。

## 程序分段

程序分段是指在执行程序时，将其分为多个段，每个段负责特定的数据类型和功能。现代操作系统通常将程序的内存分为以下主要段：

### 代码段（Text Segment）

这是存放程序代码的区域，也就是说，存储可执行指令的存储区域

它是只读的，以防止程序意外更改其自身的指令

### 数据段（Data Segment）

用于存储程序中已初始化的全局变量和静态变量

数据段也包含字符串字面量和常量

### BSS段（Block Started by Symbol Segment）

用于存储未初始化的全局变量和静态变量

在程序开始执行时，这部分的内存会被初始化为零，不占用磁盘空间，但在加载程序时被分配内存

### 堆（Heap）

用于动态内存分配。在运行时通过 `new`、`malloc` 等函数分配的内存都在堆中

堆的大小可以动态变化，程序可以在运行时请求更多的内存资源

### 栈（Stack）

用于存储局部变量、函数参数及返回地址

栈遵循后进先出（LIFO）的原则，通常在函数调用时分配内存，函数返回时释放内存

## 内存布局

内存布局是指程序执行时，它的各个段在内存中的实际排列方式。这种布局通常如下所示：

```
+-------------------+  <- 高地址
|    Stack          |  (局部变量、返回地址)
+-------------------+
|                   |  
|       Heap       |  (动态分配的内存)
|                   |  
+-------------------+
| BSS Segment       |  (未初始化的全局/static 变量)
+-------------------+
| Data Segment      |  (已初始化的全局/static 变量)
+-------------------+
| Text Segment      |  (程序代码)
+-------------------+  <- 低地址

```


## 内存管理

* **堆管理** ：在堆上分配的内存，开发者需要手动管理，确保在不再需要时释放，以避免内存泄漏
* **栈管理** ：函数结束后，栈上的所有局部变量会自动释放，不需要手动管理
* **作用域** ：局部变量存在于栈上，其生命周期仅在函数内

## 其他

### bss段 和 data段

bss段和data段都是静态内存分配，也就是说在编译的时候自动分配的。

bss和data段也有一种说法合起来叫数据段，有三种类型：

1. 只读数据段，常量与const修饰的全局变量
2. 可读可写数据段，存放初始化的全局变量和static变量
3. bss段，存放未初始化的全局变量
